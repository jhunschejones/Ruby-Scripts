#!/bin/zsh

echo "\e[37mLogging in to 1Password...\e[0m"
op signin

rm -f ./tmp/jpdb-cookie-jar.txt
rm -f ./tmp/reviews.json

echo "\e[37mGetting session cookie...\e[0m"
curl -sS -c ./tmp/jpdb-cookie-jar.txt 'https://jpdb.io/login' \
  -H 'content-type: application/x-www-form-urlencoded' \
  -H 'origin: https://jpdb.io' \
  -H 'referer: https://jpdb.io/login' \
  --data-raw "username=$(op item get "jpdb.io" --fields label=username)&password=$(op item get "jpdb.io" --fields label=password)"

echo "\e[37mDownloading reviews....\e[0m"
curl -sS -L -b ./tmp/jpdb-cookie-jar.txt 'https://jpdb.io/export/reviews.json?' --output ./tmp/reviews.json

rm -f ./tmp/jpdb-cookie-jar.txt

echo "\e[37mReviews saved to ./tmp/reviews.json ðŸŽ‰\e[0m"
